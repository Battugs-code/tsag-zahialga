<!DOCTYPE html>
<html>
  <head>
    <title>Booking system signup</title>
  </head>
  <body>
    <input id="username" placeholder="username" required />
    <input id="firstname" placeholder="firstname" required />
    <input id="lastname" placeholder="lastname" required />
    <input id="email" placeholder="email" required />
    <input id="password" type="password" placeholder="password" required />
    <button id="createBtn" onclick="login()">Create</button>
    <p id="message"></p>

    <script>
      const endpoint = "http://localhost:4000/";
      const login = async () => {
        window.location.href = "./login.html";
      };
      const createBtn = document.getElementById("createBtn");
      const message = document.getElementById("message");

      createBtn.addEventListener("click", async () => {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const username = document.getElementById("username").value;
        const firstname = document.getElementById("firstname").value;
        const lastname = document.getElementById("lastname").value;

        const mutation = `
        mutation signupUser($input: signupInput) {
          signupUser(input: $input)
            }
        `;

        try {
          const response = await fetch(endpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              query: mutation,
              variables: {
                input: {
                  email: email,
                  firstname: firstname,
                  lastname: lastname,
                  password: password,
                  username: username,
                },
              },
            }),
          });
          const result = await response.json();
          if (!result.alldata.signupUser) {
            message.textContent = `Signup succesful`;
          } else {
            message.textContent = `This email is already signed up`;
          }
        } catch (error) {
          console.error(error);
          message.textContent = "Error connecting to server";
        }
      });
    </script>
  </body>
</html>
